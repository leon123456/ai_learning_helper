# è¯•å·è¯†åˆ«è‡ªåŠ¨åŒ–æµ‹è¯•æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æä¾›äº†ä¸¤ç§è‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ¡ˆï¼Œå¯ä»¥æ‰¹é‡æµ‹è¯•è¯•å·è¯†åˆ«åŠŸèƒ½ï¼š

1. **å®Œæ•´æµ‹è¯•æ¡†æ¶** (`test_paper_auto.py`) - åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå¤šç§é…ç½®
2. **ç®€åŒ–æµ‹è¯•è„šæœ¬** (`test_gaokao_paper.py`) - ä¸“é—¨æµ‹è¯•é«˜è€ƒè¯•å·ï¼Œå¼€ç®±å³ç”¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ¡ˆ 1ï¼šç®€åŒ–æµ‹è¯•ï¼ˆæ¨èæ–°æ‰‹ï¼‰

ç›´æ¥æµ‹è¯• `test/test_png` ç›®å½•ä¸‹çš„é«˜è€ƒè¯•å·å›¾ç‰‡ï¼š

```bash
cd learning_diagnosis_backend
python test/test_gaokao_paper.py
```

**ç‰¹ç‚¹ï¼š**
- âœ… é›¶é…ç½®ï¼Œå¼€ç®±å³ç”¨
- âœ… ä½¿ç”¨ base64 æ–¹å¼ï¼Œæ— éœ€é¢å¤–æœåŠ¡
- âœ… è‡ªåŠ¨ç”Ÿæˆ JSON æµ‹è¯•æŠ¥å‘Š
- âœ… è¯¦ç»†çš„è¾“å‡ºæ ¼å¼

**è¾“å‡ºå†…å®¹ï¼š**
- æ¯å¼ å›¾ç‰‡çš„è¯†åˆ«ç»“æœ
- è¯†åˆ«è€—æ—¶ç»Ÿè®¡
- é¢˜ç›®æ•°é‡å’Œç±»å‹
- å¤§é¢˜åˆ†åŒºä¿¡æ¯
- å‰ 10 é“é¢˜ç›®é¢„è§ˆ
- JSON æ ¼å¼çš„å®Œæ•´æŠ¥å‘Š

### æ–¹æ¡ˆ 2ï¼šå®Œæ•´æµ‹è¯•æ¡†æ¶ï¼ˆæ¨èé«˜çº§ç”¨æˆ·ï¼‰

æ”¯æŒæ›´å¤šé…ç½®é€‰é¡¹å’Œæµ‹è¯•åœºæ™¯ï¼š

#### åŸºæœ¬ç”¨æ³•

```bash
# 1. åŸºæœ¬æµ‹è¯•ï¼ˆä½¿ç”¨æœ¬åœ°æ–‡ä»¶æœåŠ¡å™¨ï¼‰
python test/test_paper_auto.py

# 2. ç”Ÿæˆ HTML æŠ¥å‘Š
python test/test_paper_auto.py --html-report

# 3. ä½¿ç”¨ base64 æ–¹å¼ï¼ˆæ— éœ€å¯åŠ¨æœåŠ¡å™¨ï¼‰
python test/test_paper_auto.py --use-base64

# 4. ä½¿ç”¨å›¾åºŠä¸Šä¼ ï¼ˆéœ€è¦é…ç½® API Keyï¼‰
python test/test_paper_auto.py --use-imgbb --imgbb-key YOUR_API_KEY

# 5. æŒ‡å®šæµ‹è¯•ç›®å½•
python test/test_paper_auto.py --test-dir test/test_png

# 6. å®Œæ•´æµ‹è¯•ï¼ˆè¯†åˆ« + è¯Šæ–­ï¼‰
python test/test_paper_auto.py --with-diagnose --html-report
```

#### é«˜çº§é€‰é¡¹

```bash
python test/test_paper_auto.py --help
```

**å¯ç”¨é€‰é¡¹ï¼š**
- `--test-dir` - æŒ‡å®šæµ‹è¯•å›¾ç‰‡ç›®å½•ï¼ˆé»˜è®¤ï¼štest/test_pngï¼‰
- `--use-imgbb` - ä½¿ç”¨ ImgBB å›¾åºŠä¸Šä¼ 
- `--imgbb-key` - ImgBB API Key
- `--use-base64` - ä½¿ç”¨ base64 ç¼–ç æ–¹å¼
- `--html-report` - ç”Ÿæˆ HTML æ ¼å¼æŠ¥å‘Š
- `--with-diagnose` - åŒæ—¶æµ‹è¯•æ‰¹é‡è¯Šæ–­åŠŸèƒ½

## ğŸ“ æµ‹è¯•å›¾ç‰‡å‡†å¤‡

### 1. ç›®å½•ç»“æ„

```
learning_diagnosis_backend/
â””â”€â”€ test/
    â”œâ”€â”€ test_png/              # æµ‹è¯•å›¾ç‰‡ç›®å½•
    â”‚   â”œâ”€â”€ 2025gaokao1.png   # é«˜è€ƒè¯•å·ç¬¬1é¡µ
    â”‚   â”œâ”€â”€ 2025gaokao2.png   # é«˜è€ƒè¯•å·ç¬¬2é¡µ
    â”‚   â””â”€â”€ ...                # å…¶ä»–æµ‹è¯•å›¾ç‰‡
    â””â”€â”€ test_results/          # æµ‹è¯•ç»“æœè¾“å‡ºç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
        â”œâ”€â”€ gaokao_test_20250107_143022.json
        â”œâ”€â”€ test_report_20250107_143022.json
        â””â”€â”€ test_report_20250107_143022.html
```

### 2. æ”¯æŒçš„å›¾ç‰‡æ ¼å¼

- PNG (*.png)
- JPG/JPEG (*.jpg, *.jpeg)

### 3. å›¾ç‰‡è¦æ±‚

- **æ¸…æ™°åº¦**: å»ºè®® 300 DPI ä»¥ä¸Š
- **å¤§å°**: < 10MBï¼ˆæ¨è < 2MBï¼‰
- **å†…å®¹**: å®Œæ•´çš„è¯•å·é¡µé¢
- **æ ¼å¼**: è§„èŒƒçš„é¢˜å·å’Œé¢˜ç›®å¸ƒå±€

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

### 1. JSON æŠ¥å‘Š

**ä½ç½®**: `test/test_results/test_report_*.json`

**å†…å®¹ç¤ºä¾‹**:
```json
{
  "test_time": "2025-01-07T14:30:22",
  "total_tests": 2,
  "success_count": 2,
  "failed_count": 0,
  "total_questions": 25,
  "results": [
    {
      "image_name": "2025gaokao1.png",
      "status": "success",
      "recognition_time": 12.5,
      "total_questions": 15,
      "questions": [...]
    }
  ]
}
```

### 2. HTML æŠ¥å‘Š

**ä½ç½®**: `test/test_results/test_report_*.html`

**ç‰¹ç‚¹**:
- ğŸ“Š å¯è§†åŒ–çš„æµ‹è¯•æ‘˜è¦
- ğŸ“ˆ æ¯å¼ å›¾ç‰‡çš„è¯¦ç»†ç»“æœ
- ğŸ¨ ç¾è§‚çš„ç•Œé¢è®¾è®¡
- ğŸ“± å“åº”å¼å¸ƒå±€

**æ‰“å¼€æ–¹å¼**:
```bash
# macOS
open test/test_results/test_report_*.html

# Linux
xdg-open test/test_results/test_report_*.html

# Windows
start test/test_results/test_report_*.html
```

### 3. æ§åˆ¶å°è¾“å‡º

æµ‹è¯•è¿‡ç¨‹ä¸­ä¼šå®æ—¶è¾“å‡ºï¼š
- å½“å‰æµ‹è¯•è¿›åº¦
- è¯†åˆ«çŠ¶æ€ï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰
- è¯†åˆ«è€—æ—¶
- é¢˜ç›®æ•°é‡ç»Ÿè®¡
- å¤§é¢˜åˆ†åŒºä¿¡æ¯
- é¢˜ç›®é¢„è§ˆ

## ğŸ”§ æµ‹è¯•æ–¹å¼å¯¹æ¯”

### æ–¹å¼ 1ï¼šæœ¬åœ°æ–‡ä»¶æœåŠ¡å™¨ï¼ˆé»˜è®¤ï¼‰

**åŸç†**: å¯åŠ¨ä¸´æ—¶çš„ HTTP æœåŠ¡å™¨ï¼Œå°†æœ¬åœ°å›¾ç‰‡è½¬æ¢ä¸º URL

**ä¼˜ç‚¹**:
- âœ… æœ€æ¥è¿‘ç”Ÿäº§ç¯å¢ƒï¼ˆURL æ–¹å¼ï¼‰
- âœ… è¯†åˆ«é€Ÿåº¦å¿«
- âœ… ç¨³å®šæ€§å¥½

**ç¼ºç‚¹**:
- âš ï¸  éœ€è¦å¯åŠ¨é¢å¤–çš„æœåŠ¡å™¨
- âš ï¸  å ç”¨ç«¯å£ï¼ˆé»˜è®¤ 8001ï¼‰

**ä½¿ç”¨**:
```bash
python test/test_paper_auto.py
```

### æ–¹å¼ 2ï¼šBase64 ç¼–ç 

**åŸç†**: å°†å›¾ç‰‡è½¬æ¢ä¸º base64 ç¼–ç å­—ç¬¦ä¸²

**ä¼˜ç‚¹**:
- âœ… æ— éœ€é¢å¤–é…ç½®
- âœ… ä¸ä¾èµ–ç½‘ç»œæœåŠ¡

**ç¼ºç‚¹**:
- âš ï¸  è¯·æ±‚ä½“ç§¯å¤§
- âš ï¸  å¯èƒ½è¾ƒæ…¢
- âš ï¸  éƒ¨åˆ†åœºæ™¯å¯èƒ½ä¸ç¨³å®š

**ä½¿ç”¨**:
```bash
python test/test_paper_auto.py --use-base64
```

### æ–¹å¼ 3ï¼šå›¾åºŠä¸Šä¼ ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒæµ‹è¯•ï¼‰

**åŸç†**: å°†å›¾ç‰‡ä¸Šä¼ åˆ° ImgBB å›¾åºŠï¼Œè·å–å…¬ç½‘ URL

**ä¼˜ç‚¹**:
- âœ… æœ€æ¥è¿‘ç”Ÿäº§ç¯å¢ƒ
- âœ… å¯ä»¥æµ‹è¯•çœŸå®çš„ç½‘ç»œåœºæ™¯
- âœ… URL é•¿æœŸæœ‰æ•ˆ

**ç¼ºç‚¹**:
- âš ï¸  éœ€è¦ç”³è¯· ImgBB API Key
- âš ï¸  ä¾èµ–å¤–éƒ¨æœåŠ¡
- âš ï¸  ä¸Šä¼ éœ€è¦æ—¶é—´

**é…ç½®**:
1. è®¿é—® https://api.imgbb.com/ ç”³è¯·å…è´¹ API Key
2. ä½¿ç”¨æ—¶æŒ‡å®š API Key

**ä½¿ç”¨**:
```bash
python test/test_paper_auto.py --use-imgbb --imgbb-key YOUR_API_KEY

# æˆ–è®¾ç½®ç¯å¢ƒå˜é‡
export IMGBB_API_KEY=your_api_key
python test/test_paper_auto.py --use-imgbb
```

## ğŸ“ˆ æµ‹è¯•æŒ‡æ ‡è¯´æ˜

### 1. è¯†åˆ«æˆåŠŸç‡

```
æˆåŠŸç‡ = æˆåŠŸè¯†åˆ«çš„å›¾ç‰‡æ•° / æ€»å›¾ç‰‡æ•° Ã— 100%
```

**é¢„æœŸ**:
- âœ… ä¼˜ç§€ï¼š> 95%
- âš ï¸  è‰¯å¥½ï¼š80% - 95%
- âŒ éœ€æ”¹è¿›ï¼š< 80%

### 2. è¯†åˆ«è€—æ—¶

å•å¼ å›¾ç‰‡çš„è¯†åˆ«æ—¶é—´ï¼ˆç§’ï¼‰

**é¢„æœŸ**:
- âœ… å¿«é€Ÿï¼š< 10 ç§’
- âš ï¸  æ­£å¸¸ï¼š10 - 30 ç§’
- âŒ è¾ƒæ…¢ï¼š> 30 ç§’

**å½±å“å› ç´ **:
- å›¾ç‰‡å¤§å°
- é¢˜ç›®æ•°é‡
- ç½‘ç»œçŠ¶å†µ
- API å“åº”é€Ÿåº¦

### 3. é¢˜ç›®è¯†åˆ«å‡†ç¡®æ€§

**éªŒè¯ç‚¹**:
- âœ… é¢˜å·æ˜¯å¦æ­£ç¡®
- âœ… é¢˜å‹åˆ¤æ–­æ˜¯å¦å‡†ç¡®
- âœ… é¢˜å¹²æ˜¯å¦å®Œæ•´
- âœ… é€‰é¡¹æ˜¯å¦é½å…¨
- âœ… å¤§é¢˜åˆ†åŒºæ˜¯å¦æ­£ç¡®

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šè¯†åˆ«å¤±è´¥

**å¯èƒ½åŸå› **:
- é˜¿é‡Œäº‘ API é…ç½®é”™è¯¯
- ç½‘ç»œè¿æ¥é—®é¢˜
- å›¾ç‰‡æ ¼å¼ä¸æ”¯æŒ
- å›¾ç‰‡å†…å®¹æ— æ³•è¯†åˆ«

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥ `.env` é…ç½®
2. ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
3. éªŒè¯å›¾ç‰‡æ ¼å¼
4. æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

### é—®é¢˜ 2ï¼šè¯†åˆ«ç»“æœä¸å‡†ç¡®

**å¯èƒ½åŸå› **:
- å›¾ç‰‡æ¸…æ™°åº¦ä¸å¤Ÿ
- è¯•å·æ ¼å¼ä¸è§„èŒƒ
- åŒ…å«æ‰‹å†™å†…å®¹

**è§£å†³æ–¹æ³•**:
1. ä½¿ç”¨é«˜æ¸…æ‰«æä»¶
2. ç¡®ä¿è¯•å·æ ¼å¼è§„èŒƒ
3. é¿å…æ‰‹å†™å†…å®¹

### é—®é¢˜ 3ï¼šæœ¬åœ°æœåŠ¡å™¨ç«¯å£å ç”¨

**é”™è¯¯ä¿¡æ¯**: `Address already in use`

**è§£å†³æ–¹æ³•**:
```bash
# æ–¹å¼ 1: ä¿®æ”¹é»˜è®¤ç«¯å£
# ç¼–è¾‘ test_paper_auto.pyï¼Œä¿®æ”¹ local_server_port

# æ–¹å¼ 2: ä½¿ç”¨ base64 æ–¹å¼
python test/test_paper_auto.py --use-base64
```

### é—®é¢˜ 4ï¼šå›¾åºŠä¸Šä¼ å¤±è´¥

**å¯èƒ½åŸå› **:
- API Key æ— æ•ˆ
- ç½‘ç»œè¿æ¥é—®é¢˜
- å›¾ç‰‡è¿‡å¤§

**è§£å†³æ–¹æ³•**:
1. éªŒè¯ API Key
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. å‹ç¼©å›¾ç‰‡å¤§å°

## ğŸ¯ å®æˆ˜ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šæµ‹è¯•æ–°ä¸Šä¼ çš„è¯•å·

```bash
# 1. å°†è¯•å·å›¾ç‰‡æ”¾åˆ° test/test_png ç›®å½•
cp ~/Downloads/exam_page1.png test/test_png/
cp ~/Downloads/exam_page2.png test/test_png/

# 2. è¿è¡Œæµ‹è¯•
python test/test_gaokao_paper.py

# 3. æŸ¥çœ‹ç»“æœ
cat test/test_results/gaokao_test_*.json
```

### ç¤ºä¾‹ 2ï¼šæ‰¹é‡æµ‹è¯•å¤šå¥—è¯•å·

```bash
# 1. å‡†å¤‡ç›®å½•
mkdir -p test/test_papers/set1
mkdir -p test/test_papers/set2

# 2. åˆ†åˆ«æ”¾å…¥ä¸åŒè¯•å·

# 3. åˆ†åˆ«æµ‹è¯•
python test/test_paper_auto.py --test-dir test/test_papers/set1 --html-report
python test/test_paper_auto.py --test-dir test/test_papers/set2 --html-report
```

### ç¤ºä¾‹ 3ï¼šå®Œæ•´æµ‹è¯•æµç¨‹ï¼ˆè¯†åˆ« + è¯Šæ–­ï¼‰

```bash
# 1. è¯†åˆ«è¯•å·å¹¶ç”Ÿæˆ HTML æŠ¥å‘Š
python test/test_paper_auto.py --html-report

# 2. æŸ¥çœ‹è¯†åˆ«ç»“æœï¼Œæ‰‹åŠ¨æ ‡æ³¨æ­£ç¡®ç­”æ¡ˆ

# 3. è¿è¡Œæ‰¹é‡è¯Šæ–­æµ‹è¯•ï¼ˆå¾…å®ç°ï¼‰
# python test/test_batch_diagnose.py --test-dir test/test_png
```

## ğŸ“ æµ‹è¯•æ¸…å•

### åŸºæœ¬åŠŸèƒ½æµ‹è¯•

- [ ] èƒ½å¦æ­£ç¡®è¯†åˆ«é¢˜å·
- [ ] èƒ½å¦æ­£ç¡®è¯†åˆ«é¢˜å‹ï¼ˆé€‰æ‹©é¢˜ã€å¡«ç©ºé¢˜ã€è§£ç­”é¢˜ï¼‰
- [ ] èƒ½å¦æ­£ç¡®æå–é¢˜å¹²
- [ ] èƒ½å¦æ­£ç¡®æå–é€‰é¡¹ï¼ˆé€‰æ‹©é¢˜ï¼‰
- [ ] èƒ½å¦è¯†åˆ«å¤§é¢˜åˆ†åŒº
- [ ] èƒ½å¦è¿”å›é¢˜ç›®åæ ‡

### æ€§èƒ½æµ‹è¯•

- [ ] å•å¼ å›¾ç‰‡è¯†åˆ«è€—æ—¶ < 30 ç§’
- [ ] å¤šå¼ å›¾ç‰‡å¹¶å‘æµ‹è¯•
- [ ] å¤§å°ºå¯¸å›¾ç‰‡å¤„ç†
- [ ] é«˜é¢˜é‡è¯•å·å¤„ç†

### é²æ£’æ€§æµ‹è¯•

- [ ] ä¸åŒæ¸…æ™°åº¦çš„å›¾ç‰‡
- [ ] ä¸åŒæ ¼å¼çš„è¯•å·
- [ ] åŒ…å«å›¾å½¢çš„é¢˜ç›®
- [ ] åŒ…å«å…¬å¼çš„é¢˜ç›®
- [ ] è¾¹ç•Œæƒ…å†µï¼ˆå¦‚å•é¢˜ã€å¤§é‡é¢˜ç›®ï¼‰

### å…¼å®¹æ€§æµ‹è¯•

- [ ] ä¸åŒå­¦ç§‘è¯•å·ï¼ˆæ•°å­¦ã€ç‰©ç†ã€åŒ–å­¦ç­‰ï¼‰
- [ ] ä¸åŒå¹´çº§è¯•å·
- [ ] ä¸åŒåœ°åŒºè¯•å·æ ¼å¼

## ğŸ“ æœ€ä½³å®è·µ

1. **å›¾ç‰‡å‡†å¤‡**
   - ä½¿ç”¨é«˜æ¸…æ‰«æä»¶
   - ç¡®ä¿è¯•å·å®Œæ•´
   - é¿å…å€¾æ–œå’Œæ¨¡ç³Š

2. **æµ‹è¯•ç­–ç•¥**
   - å…ˆæµ‹è¯•å•å¼ ï¼Œå†æ‰¹é‡æµ‹è¯•
   - ä»ç®€å•åˆ°å¤æ‚
   - è®°å½•æµ‹è¯•ç»“æœ

3. **ç»“æœéªŒè¯**
   - å¯¹æ¯”åŸå›¾å’Œè¯†åˆ«ç»“æœ
   - ç»Ÿè®¡å‡†ç¡®ç‡
   - è®°å½•å¼‚å¸¸æƒ…å†µ

4. **æŒç»­æ”¹è¿›**
   - æ”¶é›†å¤±è´¥æ¡ˆä¾‹
   - åˆ†æå¤±è´¥åŸå› 
   - ä¼˜åŒ–è¯†åˆ«ç®—æ³•

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è¯•å·ç»“æ„åŒ–è¯†åˆ«åŠŸèƒ½è¯´æ˜](./è¯•å·ç»“æ„åŒ–è¯†åˆ«åŠŸèƒ½è¯´æ˜.md)
- [API ä½¿ç”¨ç¤ºä¾‹](./APIä½¿ç”¨ç¤ºä¾‹.md)
- [é˜¿é‡Œäº‘ OCR æµ‹è¯•æ€»ç»“](./é˜¿é‡Œäº‘OCRæµ‹è¯•æ€»ç»“.md)

## ğŸ‰ æ€»ç»“

é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œä½ å¯ä»¥ï¼š
1. âœ… å¿«é€ŸéªŒè¯è¯•å·è¯†åˆ«åŠŸèƒ½
2. âœ… æ‰¹é‡å¤„ç†å¤šå¼ è¯•å·
3. âœ… ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Š
4. âœ… å‘ç°å’Œè¿½è¸ªé—®é¢˜
5. âœ… æŒç»­æ”¹è¿›ç³»ç»Ÿæ€§èƒ½

ç°åœ¨å°±å¼€å§‹æµ‹è¯•ä½ çš„é«˜è€ƒè¯•å·å§ï¼ğŸš€

