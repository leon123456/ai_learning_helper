# ğŸ› é—®é¢˜è§£å†³ï¼šValueError: è‡³å°‘éœ€è¦é…ç½®ä¸€ä¸ª Azure éƒ¨ç½²

## é—®é¢˜è¯´æ˜

è¿è¡Œæµ‹è¯•æ—¶å‡ºç°é”™è¯¯ï¼š
```
ValueError: è‡³å°‘éœ€è¦é…ç½®ä¸€ä¸ª Azure éƒ¨ç½²
```

## åŸå› åˆ†æ

åŸå§‹çš„æµ‹è¯•è„šæœ¬ä½¿ç”¨äº† `LLMClient` å’Œ `PaperDiagnosticService`ï¼Œè¿™ä¸¤ä¸ªç±»éœ€è¦ LLMï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰é…ç½®æ‰èƒ½åˆå§‹åŒ–ã€‚

ä½†å®é™…ä¸Šï¼Œ**çº¯è¯•å·è¯†åˆ«æµ‹è¯•ä¸éœ€è¦ LLM**ï¼Œåªéœ€è¦é˜¿é‡Œäº‘ OCR API å³å¯ã€‚

## è§£å†³æ–¹æ¡ˆ

å·²ä¿®æ”¹ `test_gaokao_paper.py`ï¼Œç°åœ¨ç›´æ¥è°ƒç”¨é˜¿é‡Œäº‘è¯•å·è¯†åˆ« APIï¼Œç»•è¿‡ LLM Client çš„åˆå§‹åŒ–ã€‚

### ä¿®æ”¹å†…å®¹

**ä¿®æ”¹å‰ï¼š**
```python
# åˆå§‹åŒ–æœåŠ¡ï¼ˆéœ€è¦ LLM é…ç½®ï¼‰
llm = LLMClient()
service = PaperDiagnosticService(llm)

# è°ƒç”¨è¯†åˆ«æœåŠ¡
paper_structure, questions = await service.recognize_and_parse_paper(
    image_base64=image_base64
)
```

**ä¿®æ”¹åï¼š**
```python
# ç›´æ¥ä½¿ç”¨é˜¿é‡Œäº‘ OCRï¼ˆä¸éœ€è¦ LLMï¼‰
from app.services.aliyun_paper_ocr import recognize_paper_structure, parse_question_from_aliyun
from app.schemas.paper import ParsedQuestion, PaperStructure

# è°ƒç”¨é˜¿é‡Œäº‘ API
raw_data = await recognize_paper_structure(image_base64=image_base64)

# æ‰‹åŠ¨æ„å»ºæ•°æ®ç»“æ„
paper_structure = PaperStructure(...)
questions = [ParsedQuestion(...) for ...]
```

## ç°åœ¨å¯ä»¥è¿è¡Œäº†

```bash
cd learning_diagnosis_backend
python test/test_gaokao_paper.py
```

## æ‰€éœ€é…ç½®

ç°åœ¨åªéœ€è¦é…ç½®é˜¿é‡Œäº‘ OCRï¼Œä¸éœ€è¦ LLM é…ç½®ï¼š

```env
# .env æ–‡ä»¶

# é˜¿é‡Œäº‘ OCR é…ç½®ï¼ˆå¿…éœ€ï¼‰
ALIYUN_ACCESS_KEY_ID=LTAI5tRm...
ALIYUN_ACCESS_KEY_SECRET=your_secret
ALIYUN_OCR_ENDPOINT=cn-hangzhou.aliyuncs.com

# LLM é…ç½®ï¼ˆè¯•å·è¯†åˆ«æµ‹è¯•ä¸éœ€è¦ï¼‰
# PROVIDER=azure
# AZURE_OPENAI_ENDPOINT_GPT4O2=...
# AZURE_OPENAI_API_KEY_GPT4O2=...
```

## åŠŸèƒ½å¯¹æ¯”

### è¯•å·è¯†åˆ«ï¼ˆå½“å‰æµ‹è¯•ï¼‰
- âœ… **ä¸éœ€è¦ LLM** - åªç”¨é˜¿é‡Œäº‘ OCR
- âœ… è¯†åˆ«é¢˜ç›®
- âœ… æå–é¢˜å¹²ã€é€‰é¡¹
- âœ… è¿”å›åæ ‡
- âœ… å¤§é¢˜åˆ†åŒº

### æ‰¹é‡è¯Šæ–­ï¼ˆéœ€è¦ LLMï¼‰
- âŒ éœ€è¦ LLM é…ç½®
- åˆ¤æ–­å¯¹é”™
- é”™å› åˆ†æ
- æŒæ¡åº¦è¯„ä¼°
- å­¦ä¹ å»ºè®®

## å¦‚æœè¦æµ‹è¯•æ‰¹é‡è¯Šæ–­

å¦‚æœä½ æƒ³æµ‹è¯•å®Œæ•´çš„æ‰¹é‡è¯Šæ–­åŠŸèƒ½ï¼ˆåŒ…æ‹¬åˆ¤é¢˜å’Œåˆ†æï¼‰ï¼Œéœ€è¦ï¼š

1. **é…ç½® LLM**ï¼ˆé€‰æ‹©ä¸€ä¸ªï¼‰ï¼š
   ```env
   # Azure OpenAI
   PROVIDER=azure
   AZURE_OPENAI_ENDPOINT_GPT4O2=https://xxx.cognitiveservices.azure.com
   AZURE_OPENAI_API_KEY_GPT4O2=your_key
   AZURE_OPENAI_DEPLOYMENT_GPT4O2=gpt-4o-2
   
   # æˆ–ä½¿ç”¨ OpenAI
   PROVIDER=openai
   OPENAI_API_KEY=sk-xxx
   
   # æˆ–ä½¿ç”¨ DeepSeek
   PROVIDER=deepseek
   DEEPSEEK_API_KEY=sk-xxx
   ```

2. **ä½¿ç”¨å®Œæ•´æµ‹è¯•è„šæœ¬**ï¼š
   ```bash
   python test/test_paper_auto.py --with-diagnose
   ```

## æ€»ç»“

ç°åœ¨çš„æµ‹è¯•è„šæœ¬å·²ç»ä¿®å¤ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œï¼åªéœ€è¦é…ç½®é˜¿é‡Œäº‘ OCR å³å¯æµ‹è¯•è¯•å·è¯†åˆ«åŠŸèƒ½ã€‚

å¦‚æœé‡åˆ°å…¶ä»–é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. âœ… `.env` æ–‡ä»¶ä¸­çš„é˜¿é‡Œäº‘é…ç½®æ˜¯å¦æ­£ç¡®
2. âœ… ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
3. âœ… é˜¿é‡Œäº‘ RAM æƒé™æ˜¯å¦æ­£ç¡®é…ç½®

